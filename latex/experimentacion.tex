% Funcion para poner imagenes que tienen nombre con underscore:
\newcommand{\imagenB}[2]{%
\includegraphics[width=#1\textwidth]{#2}
\endgroup}

\def\imagen{\begingroup
\catcode`\_=12
\imagenB}
% -----------------------------------------
\subsection{Instancias de prueba}

Para ser lo más realista posible, se investigó\footnote{\url{http://www.britannica.com/technology/blast-furnace}} acerca de los diferentes tamaños de Altos Hornos, así como de las temperaturas que alcanzan.
En base a esto, se armaron 3 instancias de prueba distintas (las discretizaciones se eligen después):
\begin{itemize}
    \item Alto Horno de Plomo:
        \begin{itemize}
            \item Radio pared interna: $r_i = 5$
            \item Radio pared externa: $r_e = 6$
            \item Temperatura pared interna: $T(r_i, \theta_j) = 327\ Cº$, $\forall\ 1 \leq j \leq n$
            \item Temperatura pared externa: $T(r_e, \theta_j) = 20\ Cº$, $\forall\ 1 \leq j \leq n$
        \end{itemize}
    \item Alto Horno de Zinc:
        \begin{itemize}
            \item Radio pared interna: $r_i = 7$
            \item Radio pared externa: $r_e = 9$
            \item Temperatura pared interna: $T(r_i, \theta_j) = 419.5\ Cº$, $\forall\ 1 \leq j \leq n$
            \item Temperatura pared externa: $T(r_e, \theta_j) = 20\ Cº$, $\forall\ 1 \leq j \leq n$
        \end{itemize}
    \item Alto Horno de Hierro:
        \begin{itemize}
            \item Radio pared interna: $r_i = 11$
            \item Radio pared externa: $r_e = 15$
            \item Temperatura pared interna: $T(r_i, \theta_j) = 1538\ Cº$, $\forall\ 1 \leq j \leq n$
            \item Temperatura pared externa: $T(r_e, \theta_j) = 20\ Cº$, $\forall\ 1 \leq j \leq n$
        \end{itemize}
\end{itemize}

\subsection{Número de condición}

Antes de empezar a experimentar, queremos saber para cada instancia de prueba que tamaño de discretizaciones son aceptables, en terminos del Número de Condición ($K$).
En el caso de que este fuera muy grande, al resolver el sistema no tendríamos garantía de que la solución hallada fuera efectivamente buena. Esta medida se calcula de la forma:

$$K(A) = ||A||_{\infty} * ||A^{-1}||_{\infty} = \left( \max\limits_{1\leq i \leq n\times(m+1)}\sum_{j=1}^{n\times(m+1)}{|a_{i,j}|} \right) * \left( \max\limits_{1\leq i \leq n\times(m+1)}\sum_{j=1}^{n\times(m+1)}{|a_{i,j}^{-1}|} \right)$$

Tomando una discretización inicial de 30 ángulos ($n = 30$) y 30 radios ($m = 30$), tenemos que:
\begin{itemize}
    \item Para el Alto Horno de Plomo, el número de condición es: 1678.42
    \item Para el Alto Horno de Zinc, el número de condición es: 419.448
    \item Para el Alto Horno de Hierro, el número de condición es: 104.844
\end{itemize}

Pero observemos cual es el espesor del horno para cada instancia de prueba:
\begin{itemize}
    \item Para el Alto Horno de Plomo, el espesor de la pared es de $r_e - r_i = 1$.
    \item Para el Alto Horno de Zinc, el espesor de la pared es de $r_e - r_i = 2$.
    \item Para el Alto Horno de Hierro, el espesor de la pared es de $r_e - r_i = 4$.
\end{itemize}

Luego, plantemos la siguiente \textbf{Hipotesis:} \textit{el número de condición aumenta con la cantidad de ecuaciones (relacionado a la cantidad de angulos y radios) y disminuye al aumentar el espesor de la pared (diferencia entre el radio externo e interno).} Intuitivamente, podemos pensar el espesor de la pared como el espacio a resolver, y al aumentar las ecuaciones aumenta la redundancia (disminuye la indepencia) del sistema.

Podemos entonces probar con una discretización de 60 ángulos ($n = 60$) y 60 radios ($m = 60$);
\begin{itemize}
    \item Para el Alto Horno de Plomo, el número de condición es: 6957.49
    \item Para el Alto Horno de Zinc, el número de condición es: 1739.99
    \item Para el Alto Horno de Hierro, el número de condición es: 435.281
\end{itemize}

Vemos que el resultado corrobora nuestra hipotesis.

Más aún, el mayor número de condición (con las discretizaciones vistas) es 6957.49, que es relativamente aceptable\footnote{Fuente: \textit{Numerical Mathematics and Computing, by Cheney and Kincaid.}, con un número de condición de $10^k$, se pierde $k$ dígitos de precisión. Como el formato \textit{double} maneja una precisión de al menos 15 dígitos, los valores obtenidos son aceptables.}.

\subsection{Calidad de las soluciones}

Ahora que ya vimos que el Número de Condición para los hornos y discretizaciones propuestos es aceptable, podemos ver efectivamente cual es la calidad de la solución:

Llamemos $\tilde{x}$ al resultado de resolver el sistema $Ax = b$, y $\tilde{b}$ al resultado de multiplicar $A$ por $\tilde{x}$, donde $A$ es la matriz del sistema y $b$ es el termino independiente, dado por las temperaturas de la pared exterior, la pared interior y el término independiente de la ecuación del calor.

\medskip

Luego, podemos definir $\Delta(b, \tilde{b}) = \max\limits_{1 \leq i \leq n\times(m+1)}|b[i] - \tilde{b}[i]|$.

Al resolver los sistemas con X obtenemos los siguientes resultados:

\begin{table}[H]
    \begin{center}
        \begin{tabular}{| l | c | c | c |}
            \hline
            Instancia de prueba & $\Delta(b, \tilde{b})$ \\ \hline
            H. Plomo - 30x30    & 1.74623e-10            \\
            H. Plomo - 60x60    & 4.36557e-11            \\
            H. Zinc - 30x30     & 5.82077e-11            \\
            H. Zinc - 60x60     & 9.31323e-10            \\
            H. Hierro - 30x30   & 2.32831e-10            \\
            H. Hierro - 60x60   & 2.32831e-10            \\
            \hline
        \end{tabular}
        \captionsetup{justification=centering}
        \caption{Calidad de las soluciones para las distintas instancias de pruebas y discretizaciones.}
    \end{center}
\end{table}

Viendo los distintos $\Delta(b, \tilde{b})$ podemos concluir que tenemos, en el peor caso, una precision de $10^{-10}$, lo cual es muy aceptable.

\subsection{Comportamiento del sistema}

\subsubsection{Distintas discretizaciones}
% Considerar al menos dos instancias de prueba, generando distintas discretizaciones para
% cada una de ellas y comparando la ubicaci ́on de la isoterma buscada respecto de la pared
% externa del horno. Se sugiere presentar gr ́aficos de temperatura o curvas de nivel para los
% mismos, ya sea utilizando las herramientas provistas por la c ́atedra o implementando sus
% propias herramientas de graficaci ́on.

En primer lugar, para cada horno mencionado en las instancias de pruebas, vamos a definir una isoterma.
\begin{itemize}
    \item Para el Alto Horno de Plomo, la isoterma buscada será de: $200\ Cº$
    \item Para el Alto Horno de Zinc, la isoterma buscada será de: $350\ Cº$
    \item Para el Alto Horno de Hierro, la isoterma buscada será de: $1300\ Cº$
\end{itemize}

Luego, para cada horno se resolvió el sistema de ecuaciones mediante factorización LU, y se utilizaron los distintos métodos propuestos en la sección Implementación para hallar las isotermas correspondientes a partir de las soluciones de los sistemas.

Los resultados obtenidos se muestran a continuación:

\begin{table}[H]
    \begin{center}
        \begin{tabular}{| l | c | c | c |}
            \hline
            Instancia de prueba & Isoterma Promedio & Isoterma Regresión Lineal & Isoterma Búsqueda Binaria \\ \hline
            H. Plomo - 30x30    & 5.3965            & 5.3988                    & 5.3916                    \\
            H. Plomo - 60x60    & 5.3983            & 5.3986                    & 5.3916                    \\
            H. Zinc - 30x30     & 7.3103            & 7.3060                    & 7.3126                    \\
            H. Zinc - 60x60     & 7.3220            & 7.3053                    & 7.3127                    \\
            H. Hierro - 30x30   & 11.4827           & 11.5226                   & 11.5477                   \\
            H. Hierro - 60x60   & 11.5762           & 11.5208                   & 11.5479                   \\
            \hline
        \end{tabular}
        \captionsetup{justification=centering}
        \caption{Resultados obtenidos para las distintas instancias de prueba\\ y distintos métodos para hallar la isoterma.}
        \label{tablaisoterma}
    \end{center}
\end{table}
\textit{Nota: como las instancias de prueba tienen la misma temperatura de la pared interior para todos sus ángulos, y la misma temperatura de la pared exterior para todos sus ángulos, el radio de la isoterma tiene el mismo valor para todos los ángulos. Es por eso que solo se presenta un valor en el Cuadro \ref{tablaisoterma} y no $n$ valores.}

\medskip

Y, a modo de ejemplo, las figuras \ref{fig:solucion_hierro_1} y \ref{fig:isoterma_binaria_hierro_1} muestran para el Alto Horno de Hierro la úbicación de la isoterma con respecto a las paredes, y la evolución de la temperatura dentro de las mismas. Los gráficos para los otros Hornos son muy similares por lo que se omiten.

\begin{figure}[H]
    \begin{center}
        \imagen{0.7}{imagenes/test_horno_hierro1.png}
        \caption{Evolución de las temperaturas para el Alto Horno de Hierro}
        \label{fig:solucion_hierro_1}
    \end{center}
\end{figure}

\begin{figure}[H]
    \begin{center}
        \imagen{0.50}{imagenes/test_isoterma_horno_hierro_1_binaria.png}
        \captionsetup{justification=centering}
        \caption{Ubicación de la isoterma para el Alto Horno de Hierro\\ (utilizando el método de Búsqueda Binaria)}
        \label{fig:isoterma_binaria_hierro_1}
    \end{center}
\end{figure}

Analizando los valores obtenidos en el Cuadro \ref{tablaisoterma}:
\begin{itemize}
    \item En todas las instancias de pruebas, la diferencia entre la discretización de 30x30 y la discretización de 60x60 no supera nunca $0.1$, con lo que podemos concluir que el aumento en la discretización es significativo a nivel de 1 decimal. Esto es importante ya que en el Alto Horno de Plomo por ejemplo, el espesor es de 1 metro por lo que la isoterma hallada con una discretización de 30x30 podría variar $\pm 0.1m$, que en este espesor es exactamente $\pm 0.1\%$.
    \item Teniendo en cuenta que al realizar la discretización de la ecuación del calor para construir la representación del sistema tenemos cierta perdida de precisión, y que la naturaleza misma de la arítmetica finita que realiza el computador puede llevar a errores de precisión, no podemos garantizar que las isotermas halladas sean 100\% confiables.

        Sin embargo, al comparar los distintos métodos para hallar la isoterma, dentro del mismo error de precisión, podemos ver que el mejor método es el de \textit{Búsqueda Binaria}, ya que con una discretización de 30x30 obtiene unos resultados muy similares (mirando los primeros 4 decimales) que con una discretización de 60x60. En el otro extremo, tenemos que el método de \textit{Promedio} es el más burdo, teniendo una variación importante entre las diferentes discretizaciones. Esto último lo atribuimos que este método no tiene en cuenta la forma en la que se se resuelve el sistema original, realizando un simple promedio entre dos cotas de la isoterma, mientras que el método \textit{Búsqueda Binaria} utiliza internamente el método de Eliminación Gaussiana.

        En un punto intermedio se encuentra el método de \textit{Regresión Lineal}, que varía al aumentar la discretización pero cada vez menos, estabilizandose en un valor a medida que se aumenta la discretización.
\end{itemize}

\subsubsection{Proximidad de la isoterma}

% Estudiar la proximidad de la isoterma buscada respecto de la pared exterior del horno en
% funci ́
% on de distintas granularidades de discretizaci ́on y las condiciones de borde.

Para estudiar la proximidad de la isoterma buscada respecto de la pared exterior del horno vamos a usar las siguientes instancias de prueba:
\begin{itemize}
    \item Alto Horno de Plomo, variando la temperatura de la pared externa a $180\ Cº$, con una discretización de 15 ángulos y 15 radios.
    \item Alto Horno de Plomo, variando la temperatura de la pared externa a $180\ Cº$, con una discretización de 30 ángulos y 30 radios.
    \item Alto Horno de Plomo, variando la temperatura de la pared externa a $180\ Cº$, con una discretización de 60 ángulos y 60 radios.
\end{itemize}

Se experimentará con los 3 métodos propuestos para hallar isotermas (Promedio, Regresión Lineal y Búsqueda Binaria) y con las 2 medidas de peligrosidad propuestas (Proximidad Porcentual Simple y Promediada).

La siguiente tabla muestra los resultados obtenidos:

\begin{table}[H]
    \begin{center}
        \begin{tabular}{| l | c | c | c |}
            \hline
            Instancia de prueba & Isoterma Promedio & Isoterma Regresión Lineal & Isoterma Búsqueda Binaria \\ \hline
            H. Plomo - 15x15    & 5.8214            & 5.8500                    & 5.8529                    \\
            H. Plomo - 30x30    & 5.8448            & 5.8495                    & 5.8529                    \\
            H. Plomo - 60x60    & 5.8559            & 5.8493                    & 5.8529                    \\
            \hline
        \end{tabular}
        \captionsetup{justification=centering}
        \caption{Resultados obtenidos para las distintas instancias de prueba\\ y distintos métodos para hallar la isoterma.}
        \label{tabla-isoterma-plomo}
    \end{center}
\end{table}

Luego, si tomamos un $\varepsilon_C = 0.25$ tenemos que para todos lo métodos y discretizaciones la estructura se encuentra en peligro ($r_e - (r_e - r_i)*0.25 = 5.75$).
Y tomando un $\varepsilon_C = 0.10$ tenemos que para todos lo métodos y discretizaciones la estructura \textbf{no} se encuentra en peligro ($r_e - (r_e - r_i)*0.10 = 5.90$).

Por último, tomando un valor intermedio de $\varepsilon_C = 0.15$ ($r_e - (r_e - r_i)*0.15 = 5.85$) tenemos que:

\begin{table}[H]
    \begin{center}
        \begin{tabular}{| l | c | c | c |}
            \hline
            Instancia de prueba & Isoterma Promedio  & Isoterma Regresión Lineal & Isoterma Búsqueda Binaria \\ \hline
            H. Plomo - 15x15    & Fuera de peligro   & \textbf{Peligrosa}        & \textbf{Peligrosa}        \\
            H. Plomo - 30x30    & Fuera de peligro   & Fuera de peligro          & \textbf{Peligrosa}        \\
            H. Plomo - 60x60    & \textbf{Peligrosa} & Fuera de peligro          & \textbf{Peligrosa}        \\
            \hline
        \end{tabular}
        \captionsetup{justification=centering}
        \caption{Evaluación de la peligrosidad de la estructura con $\varepsilon_C = 0.15$}
        \label{tabla-peligro-estructura-plomo}
    \end{center}
\end{table}

\textit{Nota: en el Cuadro \ref{tabla-peligro-estructura-plomo} es indistinto si la medida de peligrosidad utilizada es la Proximidad Porcentual Simple o Promediada, ya que las instancias de prueba tienen la misma temperatura de la pared interior para todos sus ángulos, la misma temperatura de la pared exterior para todos sus ángulos,y por lo tanto el radio de la isoterma tiene el mismo valor para todos los ángulos, por lo que es equivalente realizar el promedio de todos los ángulos a evaluar cualquiera de los ángulos de la isoterma.}

\medskip

Analizando los valores obtenidos en el Cuadro \ref{tabla-isoterma-plomo}:
\begin{itemize}
    \item Para el método de \textit{Búsqueda Binaria} no influyó los primero 4 decimales que se varíe la discretización. Esto lo atribuimos a que éste método utiliza la misma mecánica que el método de Eliminación Gaussiana y continúa hasta que satisface una precisión determinada, por lo que es entendible que las distintas discretizaciones den resultados parecidos en los primeros decimales.
    \item El método de \textit{Regresión Lineal} converge a medida que aumentamos la discretización, cada vez variando menos. Esto lo atribuimos a que a medida que aumentamos la discretización, también aumenta la cantidad de puntos que tiene en cuenta el método para cada ángulo, convergiendo en una función lineal en particular.
    \item Para el método de \textit{Promedio}, la variación entre las distintas discretizacion es bastante, pero podemos ver que para la última discretización (60x60), este método calcula una isoterma muy similar al método de \textit{Búsqueda Binaria}.
    \item En base a esto último, es interesante notar que lo que parece ser el valor más confiable de la isoterma ($5.85\dots$) es aproximado tanto utilizando \textit{Búsqueda Binaria} con discretización 15x15 como haciendo \textit{Promedio} con discretización 60x60. En este aspecto, podemos inferir que el primero de los dos, por la forma en la que funciona, puede partir de cualquier discretización y arrivar a resultados parecidos.
    \item Para finalizar, tomando el promedio de las distintas isotermas halladas para la discretización de 60x60 tenemos: $5.8527$, que usando un $\varepsilon_C = 0.15$ definiriamos como \textbf{Peligrosa}, lo que se corresponde con el promedio de la ``peligrosidad'': \textit{Promedio} y \textit{Búsqueda Binaria} dicen que la estructura es \textbf{Peligrosa} y \textit{Regresión Lineal} dice que está fuera de peligro.
\end{itemize}

% exp_isoterma_horno_plomo_3a...
% 	Generando imagenes...
%
% 	Evaluando estructura...
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_avg): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_linear_fit): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_linear_fit): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_binaria): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_binaria): false
% ok
% exp_isoterma_horno_plomo_3b...
% 	Generando imagenes...
%
% 	Evaluando estructura...
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_avg): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_linear_fit): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_binaria): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_binaria): false
% ok
% exp_isoterma_horno_plomo_3c...
% 	Generando imagenes...
%
% 	Evaluando estructura...
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_avg): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_linear_fit): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.25, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_avg): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.15, iso_binaria): true
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.1, iso_binaria): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_avg): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_linear_fit): false
% 	La estructura esta en peligro (SIMPLE, epsilon: 0.05, iso_binaria): false
% ok

\subsection{Evaluación de los métodos}

\subsubsection{Tiempo de cómputo}
\begin{center}

    \begin{tikzpicture}
    \begin{axis}[
        title={},
        xlabel={n*(m+1)},
        ylabel={Tiempos de ejecucion (nanoseconds)},
        scaled x ticks=false,
        scaled y ticks=false,
        enlargelimits=0.05,
        width=0.5\textwidth,
        height=0.5\textwidth,
        legend pos=north west,
        xmin=5
    ]
    \addplot[color=black] table[x index=0,y index=1]{datos/salida.txt};
    \legend{GAUSS}
    \end{axis}
    \end{tikzpicture}
    \begin{tikzpicture}
    \begin{axis}[
        title={},
        xlabel={n*(m+1)},
        ylabel={},
        scaled x ticks=false,
        scaled y ticks=false,
        enlargelimits=0.05,
        width=0.5\textwidth,
        height=0.5\textwidth,
        legend pos=north west,
        xmin=5
    ]
    \addplot[color=black] table[x index=0,y index=2]{datos/salida.txt};
    \legend{LU}
    \end{axis}
    \end{tikzpicture}
\end{center}


\subsubsection{Variación a lo largo del tiempo}
